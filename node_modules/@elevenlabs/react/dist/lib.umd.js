!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("react"),require("@elevenlabs/client")):"function"==typeof define&&define.amd?define(["exports","react","@elevenlabs/client"],n):n((e||self).react={},e.react,e.client)}(this,function(e,n,t){function r(){return r=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)({}).hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},r.apply(null,arguments)}var o=["micMuted","volume","serverLocation"];function i(e){switch(void 0===e&&(e="us"),e){case"eu-residency":case"in-residency":case"us":case"global":return e;default:return console.warn("[ConversationalAI] Invalid server-location: "+e+'. Defaulting to "us"'),"us"}}function u(e){return{us:"wss://api.elevenlabs.io","eu-residency":"wss://api.eu.residency.elevenlabs.io","in-residency":"wss://api.in.residency.elevenlabs.io",global:"wss://api.elevenlabs.io"}[e]}function l(e){return{us:"wss://livekit.rtc.elevenlabs.io","eu-residency":"wss://livekit.rtc.eu.residency.elevenlabs.io","in-residency":"wss://livekit.rtc.in.residency.elevenlabs.io",global:"wss://livekit.rtc.elevenlabs.io"}[e]}Object.defineProperty(e,"AudioFormat",{enumerable:!0,get:function(){return t.AudioFormat}}),Object.defineProperty(e,"CommitStrategy",{enumerable:!0,get:function(){return t.CommitStrategy}}),Object.defineProperty(e,"RealtimeEvents",{enumerable:!0,get:function(){return t.RealtimeEvents}}),Object.defineProperty(e,"postOverallFeedback",{enumerable:!0,get:function(){return t.postOverallFeedback}}),e.getLivekitUrlForLocation=l,e.getOriginForLocation=u,e.parseLocation=i,e.useConversation=function(e){void 0===e&&(e={});var c=e.micMuted,a=e.volume,s=e.serverLocation,d=function(e,n){if(null==e)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==n.indexOf(r))continue;t[r]=e[r]}return t}(e,o),v=n.useRef(null),f=n.useRef(null),m=n.useState("disconnected"),h=m[0],g=m[1],p=n.useState(!1),C=p[0],S=p[1],b=n.useState("listening"),T=b[0],y=b[1],M=n.useRef(c),E=n.useRef(a);return M.current=c,E.current=a,n.useEffect(function(){var e;void 0!==c&&(null==v||null==(e=v.current)||e.setMicMuted(c))},[c]),n.useEffect(function(){var e;void 0!==a&&(null==v||null==(e=v.current)||e.setVolume({volume:a}))},[a]),n.useEffect(function(){return function(){var e;null==(e=v.current)||e.endSession()}},[]),{startSession:function(e){try{var n,o,c=function(n){return o?n:function(n,o){try{var c=(I=u(w=i((null==e?void 0:e.serverLocation)||s)),A=l(w),f.current=t.Conversation.startSession(r({},null!=d?d:{},null!=e?e:{},{origin:I,livekitUrl:A,overrides:r({},null!=(a=null==d?void 0:d.overrides)?a:{},null!=(m=null==e?void 0:e.overrides)?m:{},{client:r({},null!=(h=null==d||null==(p=d.overrides)?void 0:p.client)?h:{},null!=(C=null==e||null==(b=e.overrides)?void 0:b.client)?C:{},{source:(null==e||null==(T=e.overrides)||null==(T=T.client)?void 0:T.source)||(null==d||null==(R=d.overrides)||null==(R=R.client)?void 0:R.source)||"react_sdk",version:(null==e||null==(D=e.overrides)||null==(D=D.client)?void 0:D.version)||(null==d||null==(P=d.overrides)||null==(P=P.client)?void 0:P.version)||"0.11.0"})}),onConnect:(null==e?void 0:e.onConnect)||(null==d?void 0:d.onConnect),onDisconnect:(null==e?void 0:e.onDisconnect)||(null==d?void 0:d.onDisconnect),onError:(null==e?void 0:e.onError)||(null==d?void 0:d.onError),onMessage:(null==e?void 0:e.onMessage)||(null==d?void 0:d.onMessage),onAudio:(null==e?void 0:e.onAudio)||(null==d?void 0:d.onAudio),onDebug:(null==e?void 0:e.onDebug)||(null==d?void 0:d.onDebug),onUnhandledClientToolCall:(null==e?void 0:e.onUnhandledClientToolCall)||(null==d?void 0:d.onUnhandledClientToolCall),onVadScore:(null==e?void 0:e.onVadScore)||(null==d?void 0:d.onVadScore),onInterruption:(null==e?void 0:e.onInterruption)||(null==d?void 0:d.onInterruption),onAgentToolResponse:(null==e?void 0:e.onAgentToolResponse)||(null==d?void 0:d.onAgentToolResponse),onConversationMetadata:(null==e?void 0:e.onConversationMetadata)||(null==d?void 0:d.onConversationMetadata),onMCPToolCall:(null==e?void 0:e.onMCPToolCall)||(null==d?void 0:d.onMCPToolCall),onMCPConnectionStatus:(null==e?void 0:e.onMCPConnectionStatus)||(null==d?void 0:d.onMCPConnectionStatus),onAsrInitiationMetadata:(null==e?void 0:e.onAsrInitiationMetadata)||(null==d?void 0:d.onAsrInitiationMetadata),onAgentChatResponsePart:(null==e?void 0:e.onAgentChatResponsePart)||(null==d?void 0:d.onAgentChatResponsePart),onModeChange:function(n){var t,r=n.mode;y(r),null==(t=(null==e?void 0:e.onModeChange)||(null==d?void 0:d.onModeChange))||t({mode:r})},onStatusChange:function(n){var t,r=n.status;g(r),null==(t=(null==e?void 0:e.onStatusChange)||(null==d?void 0:d.onStatusChange))||t({status:r})},onCanSendFeedbackChange:function(n){var t,r=n.canSendFeedback;S(r),null==(t=(null==e?void 0:e.onCanSendFeedbackChange)||(null==d?void 0:d.onCanSendFeedbackChange))||t({canSendFeedback:r})}})),Promise.resolve(f.current).then(function(e){return v.current=e,void 0!==M.current&&v.current.setMicMuted(M.current),void 0!==E.current&&v.current.setVolume({volume:E.current}),v.current.getId()}))}catch(e){return o(!0,e)}var a,m,h,p,C,b,T,R,D,P,w,I,A;return c&&c.then?c.then(o.bind(null,!1),o.bind(null,!0)):o(!1,c)}(0,function(e,n){if(f.current=null,e)throw n;return n})};if(null!=(n=v.current)&&n.isOpen())return Promise.resolve(v.current.getId());var a=function(){if(f.current)return Promise.resolve(f.current).then(function(e){var n=e.getId();return o=1,n})}();return Promise.resolve(a&&a.then?a.then(c):c(a))}catch(e){return Promise.reject(e)}},endSession:function(){try{var e=v.current;return v.current=null,Promise.resolve(null==e?void 0:e.endSession()).then(function(){})}catch(e){return Promise.reject(e)}},setVolume:function(e){var n;null==(n=v.current)||n.setVolume({volume:e.volume})},getInputByteFrequencyData:function(){var e;return null==(e=v.current)?void 0:e.getInputByteFrequencyData()},getOutputByteFrequencyData:function(){var e;return null==(e=v.current)?void 0:e.getOutputByteFrequencyData()},getInputVolume:function(){var e,n;return null!=(e=null==(n=v.current)?void 0:n.getInputVolume())?e:0},getOutputVolume:function(){var e,n;return null!=(e=null==(n=v.current)?void 0:n.getOutputVolume())?e:0},sendFeedback:function(e){var n;null==(n=v.current)||n.sendFeedback(e)},getId:function(){var e;return null==(e=v.current)?void 0:e.getId()},sendContextualUpdate:function(e){var n;null==(n=v.current)||n.sendContextualUpdate(e)},sendUserMessage:function(e){var n;null==(n=v.current)||n.sendUserMessage(e)},sendUserActivity:function(){var e;null==(e=v.current)||e.sendUserActivity()},sendMCPToolApprovalResult:function(e,n){var t;null==(t=v.current)||t.sendMCPToolApprovalResult(e,n)},changeInputDevice:function(e){try{var n,t=function(e){if(n)return e;throw new Error("Device switching is only available for voice conversations")},r=function(){if(v.current&&"changeInputDevice"in v.current)return Promise.resolve(v.current.changeInputDevice(e)).then(function(e){return n=1,e})}();return Promise.resolve(r&&r.then?r.then(t):t(r))}catch(e){return Promise.reject(e)}},changeOutputDevice:function(e){try{var n,t=function(e){if(n)return e;throw new Error("Device switching is only available for voice conversations")},r=function(){if(v.current&&"changeOutputDevice"in v.current)return Promise.resolve(v.current.changeOutputDevice(e)).then(function(e){return n=1,e})}();return Promise.resolve(r&&r.then?r.then(t):t(r))}catch(e){return Promise.reject(e)}},status:h,canSendFeedback:C,micMuted:c,isSpeaking:"speaking"===T}},e.useScribe=function(e){void 0===e&&(e={});var o=e.onSessionStarted,i=e.onPartialTranscript,u=e.onCommittedTranscript,l=e.onCommittedTranscriptWithTimestamps,c=e.onError,a=e.onAuthError,s=e.onConnect,d=e.onDisconnect,v=e.onQuotaExceededError,f=e.token,m=e.modelId,h=e.baseUri,g=e.commitStrategy,p=e.vadSilenceThresholdSecs,C=e.vadThreshold,S=e.minSpeechDurationMs,b=e.minSilenceDurationMs,T=e.languageCode,y=e.microphone,M=e.audioFormat,E=e.sampleRate,R=e.autoConnect,D=void 0!==R&&R,P=n.useRef(null),w=n.useState("disconnected"),I=w[0],A=w[1],k=n.useState(""),O=k[0],F=k[1],U=n.useState([]),j=U[0],x=U[1],V=n.useState(null),L=V[0],_=V[1];n.useEffect(function(){return function(){var e;null==(e=P.current)||e.close()}},[]);var q=n.useCallback(function(e){void 0===e&&(e={});try{if(P.current)return console.warn("Already connected"),Promise.resolve();try{A("connecting"),_(null);var n=e.token||f,r=e.modelId||m;if(!n)throw new Error("Token is required");if(!r)throw new Error("Model ID is required");var R,D=e.microphone||y,w=e.audioFormat||M,I=e.sampleRate||E,k=!(!e.onCommittedTranscriptWithTimestamps&&!l);if(D)R=t.Scribe.connect({token:n,modelId:r,baseUri:e.baseUri||h,commitStrategy:e.commitStrategy||g,vadSilenceThresholdSecs:e.vadSilenceThresholdSecs||p,vadThreshold:e.vadThreshold||C,minSpeechDurationMs:e.minSpeechDurationMs||S,minSilenceDurationMs:e.minSilenceDurationMs||b,languageCode:e.languageCode||T,microphone:D,includeTimestamps:k});else{if(!w||!I)throw new Error("Either microphone options or (audioFormat + sampleRate) must be provided");R=t.Scribe.connect({token:n,modelId:r,baseUri:e.baseUri||h,commitStrategy:e.commitStrategy||g,vadSilenceThresholdSecs:e.vadSilenceThresholdSecs||p,vadThreshold:e.vadThreshold||C,minSpeechDurationMs:e.minSpeechDurationMs||S,minSilenceDurationMs:e.minSilenceDurationMs||b,languageCode:e.languageCode||T,includeTimestamps:k,audioFormat:w,sampleRate:I})}P.current=R,R.on(t.RealtimeEvents.SESSION_STARTED,function(){A("connected"),null==o||o()}),R.on(t.RealtimeEvents.PARTIAL_TRANSCRIPT,function(e){var n=e;F(n.text),A("transcribing"),null==i||i(n)}),R.on(t.RealtimeEvents.COMMITTED_TRANSCRIPT,function(e){var n=e,t={id:Date.now()+"-"+Math.random(),text:n.text,timestamp:Date.now(),isFinal:!0};x(function(e){return[].concat(e,[t])}),F(""),null==u||u(n)}),R.on(t.RealtimeEvents.COMMITTED_TRANSCRIPT_WITH_TIMESTAMPS,function(e){var n=e,t={id:Date.now()+"-"+Math.random(),text:n.text,timestamp:Date.now(),isFinal:!0};x(function(e){return[].concat(e,[t])}),F(""),null==l||l(n)}),R.on(t.RealtimeEvents.ERROR,function(e){var n=e;_(n.error),A("error"),null==c||c(new Error(n.error))}),R.on(t.RealtimeEvents.AUTH_ERROR,function(e){var n=e;_(n.error),A("error"),null==a||a(n)}),R.on(t.RealtimeEvents.QUOTA_EXCEEDED,function(e){var n=e;_(n.error),A("error"),null==v||v(n)}),R.on(t.RealtimeEvents.OPEN,function(){null==s||s()}),R.on(t.RealtimeEvents.CLOSE,function(){A("disconnected"),P.current=null,null==d||d()})}catch(e){var O=e instanceof Error?e.message:"Failed to connect";throw _(O),A("error"),e}return Promise.resolve()}catch(e){return Promise.reject(e)}},[f,m,h,g,p,C,S,b,T,y,M,E,o,i,u,l,c,a,s,d,v]),N=n.useCallback(function(){var e;null==(e=P.current)||e.close(),P.current=null,A("disconnected")},[]),B=n.useCallback(function(e,n){if(!P.current)throw new Error("Not connected to Scribe");P.current.send(r({audioBase64:e},n))},[]),W=n.useCallback(function(){if(!P.current)throw new Error("Not connected to Scribe");P.current.commit()},[]),H=n.useCallback(function(){x([]),F("")},[]),Q=n.useCallback(function(){return P.current},[]);return n.useEffect(function(){D&&q()},[D,q]),{status:I,isConnected:"connected"===I||"transcribing"===I,isTranscribing:"transcribing"===I,partialTranscript:O,committedTranscripts:j,error:L,connect:q,disconnect:N,sendAudio:B,commit:W,clearTranscripts:H,getConnection:Q}}});
//# sourceMappingURL=lib.umd.js.map
