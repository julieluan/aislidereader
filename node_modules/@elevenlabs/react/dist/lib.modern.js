import{useRef as n,useState as e,useEffect as o,useCallback as r}from"react";import{Scribe as t,RealtimeEvents as l,Conversation as i}from"@elevenlabs/client";export{AudioFormat,CommitStrategy,RealtimeEvents,postOverallFeedback}from"@elevenlabs/client";function a(){return a=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var r in o)({}).hasOwnProperty.call(o,r)&&(n[r]=o[r])}return n},a.apply(null,arguments)}function u(i={}){const{onSessionStarted:u,onPartialTranscript:s,onCommittedTranscript:c,onCommittedTranscriptWithTimestamps:d,onError:v,onAuthError:m,onConnect:g,onDisconnect:p,onQuotaExceededError:h,token:C,modelId:S,baseUri:T,commitStrategy:M,vadSilenceThresholdSecs:b,vadThreshold:w,minSpeechDurationMs:y,minSilenceDurationMs:D,languageCode:f,microphone:I,audioFormat:E,sampleRate:A,autoConnect:R=!1}=i,k=n(null),[O,F]=e("disconnected"),[P,U]=e(""),[x,V]=e([]),[_,N]=e(null);o(()=>()=>{var n;null==(n=k.current)||n.close()},[]);const q=r(async(n={})=>{if(k.current)console.warn("Already connected");else try{F("connecting"),N(null);const e=n.token||C,o=n.modelId||S;if(!e)throw new Error("Token is required");if(!o)throw new Error("Model ID is required");const r=n.microphone||I,i=n.audioFormat||E,a=n.sampleRate||A;let R;const O=!(!n.onCommittedTranscriptWithTimestamps&&!d);if(r)R=t.connect({token:e,modelId:o,baseUri:n.baseUri||T,commitStrategy:n.commitStrategy||M,vadSilenceThresholdSecs:n.vadSilenceThresholdSecs||b,vadThreshold:n.vadThreshold||w,minSpeechDurationMs:n.minSpeechDurationMs||y,minSilenceDurationMs:n.minSilenceDurationMs||D,languageCode:n.languageCode||f,microphone:r,includeTimestamps:O});else{if(!i||!a)throw new Error("Either microphone options or (audioFormat + sampleRate) must be provided");R=t.connect({token:e,modelId:o,baseUri:n.baseUri||T,commitStrategy:n.commitStrategy||M,vadSilenceThresholdSecs:n.vadSilenceThresholdSecs||b,vadThreshold:n.vadThreshold||w,minSpeechDurationMs:n.minSpeechDurationMs||y,minSilenceDurationMs:n.minSilenceDurationMs||D,languageCode:n.languageCode||f,includeTimestamps:O,audioFormat:i,sampleRate:a})}k.current=R,R.on(l.SESSION_STARTED,()=>{F("connected"),null==u||u()}),R.on(l.PARTIAL_TRANSCRIPT,n=>{const e=n;U(e.text),F("transcribing"),null==s||s(e)}),R.on(l.COMMITTED_TRANSCRIPT,n=>{const e=n,o={id:`${Date.now()}-${Math.random()}`,text:e.text,timestamp:Date.now(),isFinal:!0};V(n=>[...n,o]),U(""),null==c||c(e)}),R.on(l.COMMITTED_TRANSCRIPT_WITH_TIMESTAMPS,n=>{const e=n,o={id:`${Date.now()}-${Math.random()}`,text:e.text,timestamp:Date.now(),isFinal:!0};V(n=>[...n,o]),U(""),null==d||d(e)}),R.on(l.ERROR,n=>{const e=n;N(e.error),F("error"),null==v||v(new Error(e.error))}),R.on(l.AUTH_ERROR,n=>{const e=n;N(e.error),F("error"),null==m||m(e)}),R.on(l.QUOTA_EXCEEDED,n=>{const e=n;N(e.error),F("error"),null==h||h(e)}),R.on(l.OPEN,()=>{null==g||g()}),R.on(l.CLOSE,()=>{F("disconnected"),k.current=null,null==p||p()})}catch(n){const e=n instanceof Error?n.message:"Failed to connect";throw N(e),F("error"),n}},[C,S,T,M,b,w,y,D,f,I,E,A,u,s,c,d,v,m,g,p,h]),B=r(()=>{var n;null==(n=k.current)||n.close(),k.current=null,F("disconnected")},[]),L=r((n,e)=>{if(!k.current)throw new Error("Not connected to Scribe");k.current.send(a({audioBase64:n},e))},[]),$=r(()=>{if(!k.current)throw new Error("Not connected to Scribe");k.current.commit()},[]),W=r(()=>{V([]),U("")},[]),j=r(()=>k.current,[]);return o(()=>{R&&q()},[R,q]),{status:O,isConnected:"connected"===O||"transcribing"===O,isTranscribing:"transcribing"===O,partialTranscript:P,committedTranscripts:x,error:_,connect:q,disconnect:B,sendAudio:L,commit:$,clearTranscripts:W,getConnection:j}}const s=["micMuted","volume","serverLocation"];function c(n="us"){switch(n){case"eu-residency":case"in-residency":case"us":case"global":return n;default:return console.warn(`[ConversationalAI] Invalid server-location: ${n}. Defaulting to "us"`),"us"}}function d(n){return{us:"wss://api.elevenlabs.io","eu-residency":"wss://api.eu.residency.elevenlabs.io","in-residency":"wss://api.in.residency.elevenlabs.io",global:"wss://api.elevenlabs.io"}[n]}function v(n){return{us:"wss://livekit.rtc.elevenlabs.io","eu-residency":"wss://livekit.rtc.eu.residency.elevenlabs.io","in-residency":"wss://livekit.rtc.in.residency.elevenlabs.io",global:"wss://livekit.rtc.elevenlabs.io"}[n]}function m(r={}){const{micMuted:t,volume:l,serverLocation:u}=r,m=function(n,e){if(null==n)return{};var o={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(-1!==e.indexOf(r))continue;o[r]=n[r]}return o}(r,s),g=n(null),p=n(null),[h,C]=e("disconnected"),[S,T]=e(!1),[M,b]=e("listening"),w=n(t),y=n(l);return w.current=t,y.current=l,o(()=>{var n;void 0!==t&&(null==g||null==(n=g.current)||n.setMicMuted(t))},[t]),o(()=>{var n;void 0!==l&&(null==g||null==(n=g.current)||n.setVolume({volume:l}))},[l]),o(()=>()=>{var n;null==(n=g.current)||n.endSession()},[]),{startSession:async n=>{var e;if(null!=(e=g.current)&&e.isOpen())return g.current.getId();if(p.current)return(await p.current).getId();try{var o,r,t,l,s,h,S,M,D,f;const e=c((null==n?void 0:n.serverLocation)||u),I=d(e),E=v(e);return p.current=i.startSession(a({},null!=m?m:{},null!=n?n:{},{origin:I,livekitUrl:E,overrides:a({},null!=(o=null==m?void 0:m.overrides)?o:{},null!=(r=null==n?void 0:n.overrides)?r:{},{client:a({},null!=(t=null==m||null==(l=m.overrides)?void 0:l.client)?t:{},null!=(s=null==n||null==(h=n.overrides)?void 0:h.client)?s:{},{source:(null==n||null==(S=n.overrides)||null==(S=S.client)?void 0:S.source)||(null==m||null==(M=m.overrides)||null==(M=M.client)?void 0:M.source)||"react_sdk",version:(null==n||null==(D=n.overrides)||null==(D=D.client)?void 0:D.version)||(null==m||null==(f=m.overrides)||null==(f=f.client)?void 0:f.version)||"0.11.0"})}),onConnect:(null==n?void 0:n.onConnect)||(null==m?void 0:m.onConnect),onDisconnect:(null==n?void 0:n.onDisconnect)||(null==m?void 0:m.onDisconnect),onError:(null==n?void 0:n.onError)||(null==m?void 0:m.onError),onMessage:(null==n?void 0:n.onMessage)||(null==m?void 0:m.onMessage),onAudio:(null==n?void 0:n.onAudio)||(null==m?void 0:m.onAudio),onDebug:(null==n?void 0:n.onDebug)||(null==m?void 0:m.onDebug),onUnhandledClientToolCall:(null==n?void 0:n.onUnhandledClientToolCall)||(null==m?void 0:m.onUnhandledClientToolCall),onVadScore:(null==n?void 0:n.onVadScore)||(null==m?void 0:m.onVadScore),onInterruption:(null==n?void 0:n.onInterruption)||(null==m?void 0:m.onInterruption),onAgentToolResponse:(null==n?void 0:n.onAgentToolResponse)||(null==m?void 0:m.onAgentToolResponse),onConversationMetadata:(null==n?void 0:n.onConversationMetadata)||(null==m?void 0:m.onConversationMetadata),onMCPToolCall:(null==n?void 0:n.onMCPToolCall)||(null==m?void 0:m.onMCPToolCall),onMCPConnectionStatus:(null==n?void 0:n.onMCPConnectionStatus)||(null==m?void 0:m.onMCPConnectionStatus),onAsrInitiationMetadata:(null==n?void 0:n.onAsrInitiationMetadata)||(null==m?void 0:m.onAsrInitiationMetadata),onAgentChatResponsePart:(null==n?void 0:n.onAgentChatResponsePart)||(null==m?void 0:m.onAgentChatResponsePart),onModeChange:({mode:e})=>{var o;b(e),null==(o=(null==n?void 0:n.onModeChange)||(null==m?void 0:m.onModeChange))||o({mode:e})},onStatusChange:({status:e})=>{var o;C(e),null==(o=(null==n?void 0:n.onStatusChange)||(null==m?void 0:m.onStatusChange))||o({status:e})},onCanSendFeedbackChange:({canSendFeedback:e})=>{var o;T(e),null==(o=(null==n?void 0:n.onCanSendFeedbackChange)||(null==m?void 0:m.onCanSendFeedbackChange))||o({canSendFeedback:e})}})),g.current=await p.current,void 0!==w.current&&g.current.setMicMuted(w.current),void 0!==y.current&&g.current.setVolume({volume:y.current}),g.current.getId()}finally{p.current=null}},endSession:async()=>{const n=g.current;g.current=null,await(null==n?void 0:n.endSession())},setVolume:({volume:n})=>{var e;null==(e=g.current)||e.setVolume({volume:n})},getInputByteFrequencyData:()=>{var n;return null==(n=g.current)?void 0:n.getInputByteFrequencyData()},getOutputByteFrequencyData:()=>{var n;return null==(n=g.current)?void 0:n.getOutputByteFrequencyData()},getInputVolume:()=>{var n,e;return null!=(n=null==(e=g.current)?void 0:e.getInputVolume())?n:0},getOutputVolume:()=>{var n,e;return null!=(n=null==(e=g.current)?void 0:e.getOutputVolume())?n:0},sendFeedback:n=>{var e;null==(e=g.current)||e.sendFeedback(n)},getId:()=>{var n;return null==(n=g.current)?void 0:n.getId()},sendContextualUpdate:n=>{var e;null==(e=g.current)||e.sendContextualUpdate(n)},sendUserMessage:n=>{var e;null==(e=g.current)||e.sendUserMessage(n)},sendUserActivity:()=>{var n;null==(n=g.current)||n.sendUserActivity()},sendMCPToolApprovalResult:(n,e)=>{var o;null==(o=g.current)||o.sendMCPToolApprovalResult(n,e)},changeInputDevice:async n=>{if(g.current&&"changeInputDevice"in g.current)return await g.current.changeInputDevice(n);throw new Error("Device switching is only available for voice conversations")},changeOutputDevice:async n=>{if(g.current&&"changeOutputDevice"in g.current)return await g.current.changeOutputDevice(n);throw new Error("Device switching is only available for voice conversations")},status:h,canSendFeedback:S,micMuted:t,isSpeaking:"speaking"===M}}export{v as getLivekitUrlForLocation,d as getOriginForLocation,c as parseLocation,m as useConversation,u as useScribe};
//# sourceMappingURL=lib.modern.js.map
