import{useRef as n,useState as e,useEffect as r,useCallback as o}from"react";import{Scribe as t,RealtimeEvents as i,Conversation as l}from"@elevenlabs/client";export{AudioFormat,CommitStrategy,RealtimeEvents,postOverallFeedback}from"@elevenlabs/client";function u(){return u=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)({}).hasOwnProperty.call(r,o)&&(n[o]=r[o])}return n},u.apply(null,arguments)}function c(l){void 0===l&&(l={});var c=l.onSessionStarted,a=l.onPartialTranscript,s=l.onCommittedTranscript,d=l.onCommittedTranscriptWithTimestamps,v=l.onError,m=l.onAuthError,f=l.onConnect,h=l.onDisconnect,g=l.onQuotaExceededError,p=l.token,C=l.modelId,S=l.baseUri,T=l.commitStrategy,M=l.vadSilenceThresholdSecs,b=l.vadThreshold,D=l.minSpeechDurationMs,y=l.minSilenceDurationMs,w=l.languageCode,P=l.microphone,I=l.audioFormat,E=l.sampleRate,A=l.autoConnect,R=void 0!==A&&A,k=n(null),O=e("disconnected"),F=O[0],U=O[1],x=e(""),V=x[0],_=x[1],j=e([]),N=j[0],q=j[1],B=e(null),L=B[0],W=B[1];r(function(){return function(){var n;null==(n=k.current)||n.close()}},[]);var H=o(function(n){void 0===n&&(n={});try{if(k.current)return console.warn("Already connected"),Promise.resolve();try{U("connecting"),W(null);var e=n.token||p,r=n.modelId||C;if(!e)throw new Error("Token is required");if(!r)throw new Error("Model ID is required");var o,l=n.microphone||P,u=n.audioFormat||I,A=n.sampleRate||E,R=!(!n.onCommittedTranscriptWithTimestamps&&!d);if(l)o=t.connect({token:e,modelId:r,baseUri:n.baseUri||S,commitStrategy:n.commitStrategy||T,vadSilenceThresholdSecs:n.vadSilenceThresholdSecs||M,vadThreshold:n.vadThreshold||b,minSpeechDurationMs:n.minSpeechDurationMs||D,minSilenceDurationMs:n.minSilenceDurationMs||y,languageCode:n.languageCode||w,microphone:l,includeTimestamps:R});else{if(!u||!A)throw new Error("Either microphone options or (audioFormat + sampleRate) must be provided");o=t.connect({token:e,modelId:r,baseUri:n.baseUri||S,commitStrategy:n.commitStrategy||T,vadSilenceThresholdSecs:n.vadSilenceThresholdSecs||M,vadThreshold:n.vadThreshold||b,minSpeechDurationMs:n.minSpeechDurationMs||D,minSilenceDurationMs:n.minSilenceDurationMs||y,languageCode:n.languageCode||w,includeTimestamps:R,audioFormat:u,sampleRate:A})}k.current=o,o.on(i.SESSION_STARTED,function(){U("connected"),null==c||c()}),o.on(i.PARTIAL_TRANSCRIPT,function(n){var e=n;_(e.text),U("transcribing"),null==a||a(e)}),o.on(i.COMMITTED_TRANSCRIPT,function(n){var e=n,r={id:Date.now()+"-"+Math.random(),text:e.text,timestamp:Date.now(),isFinal:!0};q(function(n){return[].concat(n,[r])}),_(""),null==s||s(e)}),o.on(i.COMMITTED_TRANSCRIPT_WITH_TIMESTAMPS,function(n){var e=n,r={id:Date.now()+"-"+Math.random(),text:e.text,timestamp:Date.now(),isFinal:!0};q(function(n){return[].concat(n,[r])}),_(""),null==d||d(e)}),o.on(i.ERROR,function(n){var e=n;W(e.error),U("error"),null==v||v(new Error(e.error))}),o.on(i.AUTH_ERROR,function(n){var e=n;W(e.error),U("error"),null==m||m(e)}),o.on(i.QUOTA_EXCEEDED,function(n){var e=n;W(e.error),U("error"),null==g||g(e)}),o.on(i.OPEN,function(){null==f||f()}),o.on(i.CLOSE,function(){U("disconnected"),k.current=null,null==h||h()})}catch(n){var O=n instanceof Error?n.message:"Failed to connect";throw W(O),U("error"),n}return Promise.resolve()}catch(n){return Promise.reject(n)}},[p,C,S,T,M,b,D,y,w,P,I,E,c,a,s,d,v,m,f,h,g]),Q=o(function(){var n;null==(n=k.current)||n.close(),k.current=null,U("disconnected")},[]),X=o(function(n,e){if(!k.current)throw new Error("Not connected to Scribe");k.current.send(u({audioBase64:n},e))},[]),z=o(function(){if(!k.current)throw new Error("Not connected to Scribe");k.current.commit()},[]),G=o(function(){q([]),_("")},[]),J=o(function(){return k.current},[]);return r(function(){R&&H()},[R,H]),{status:F,isConnected:"connected"===F||"transcribing"===F,isTranscribing:"transcribing"===F,partialTranscript:V,committedTranscripts:N,error:L,connect:H,disconnect:Q,sendAudio:X,commit:z,clearTranscripts:G,getConnection:J}}var a=["micMuted","volume","serverLocation"];function s(n){switch(void 0===n&&(n="us"),n){case"eu-residency":case"in-residency":case"us":case"global":return n;default:return console.warn("[ConversationalAI] Invalid server-location: "+n+'. Defaulting to "us"'),"us"}}function d(n){return{us:"wss://api.elevenlabs.io","eu-residency":"wss://api.eu.residency.elevenlabs.io","in-residency":"wss://api.in.residency.elevenlabs.io",global:"wss://api.elevenlabs.io"}[n]}function v(n){return{us:"wss://livekit.rtc.elevenlabs.io","eu-residency":"wss://livekit.rtc.eu.residency.elevenlabs.io","in-residency":"wss://livekit.rtc.in.residency.elevenlabs.io",global:"wss://livekit.rtc.elevenlabs.io"}[n]}function m(o){void 0===o&&(o={});var t=o.micMuted,i=o.volume,c=o.serverLocation,m=function(n,e){if(null==n)return{};var r={};for(var o in n)if({}.hasOwnProperty.call(n,o)){if(-1!==e.indexOf(o))continue;r[o]=n[o]}return r}(o,a),f=n(null),h=n(null),g=e("disconnected"),p=g[0],C=g[1],S=e(!1),T=S[0],M=S[1],b=e("listening"),D=b[0],y=b[1],w=n(t),P=n(i);return w.current=t,P.current=i,r(function(){var n;void 0!==t&&(null==f||null==(n=f.current)||n.setMicMuted(t))},[t]),r(function(){var n;void 0!==i&&(null==f||null==(n=f.current)||n.setVolume({volume:i}))},[i]),r(function(){return function(){var n;null==(n=f.current)||n.endSession()}},[]),{startSession:function(n){try{var e,r,o=function(e){return r?e:function(e,r){try{var o=(A=d(E=s((null==n?void 0:n.serverLocation)||c)),R=v(E),h.current=l.startSession(u({},null!=m?m:{},null!=n?n:{},{origin:A,livekitUrl:R,overrides:u({},null!=(t=null==m?void 0:m.overrides)?t:{},null!=(i=null==n?void 0:n.overrides)?i:{},{client:u({},null!=(a=null==m||null==(g=m.overrides)?void 0:g.client)?a:{},null!=(p=null==n||null==(S=n.overrides)?void 0:S.client)?p:{},{source:(null==n||null==(T=n.overrides)||null==(T=T.client)?void 0:T.source)||(null==m||null==(b=m.overrides)||null==(b=b.client)?void 0:b.source)||"react_sdk",version:(null==n||null==(D=n.overrides)||null==(D=D.client)?void 0:D.version)||(null==m||null==(I=m.overrides)||null==(I=I.client)?void 0:I.version)||"0.11.0"})}),onConnect:(null==n?void 0:n.onConnect)||(null==m?void 0:m.onConnect),onDisconnect:(null==n?void 0:n.onDisconnect)||(null==m?void 0:m.onDisconnect),onError:(null==n?void 0:n.onError)||(null==m?void 0:m.onError),onMessage:(null==n?void 0:n.onMessage)||(null==m?void 0:m.onMessage),onAudio:(null==n?void 0:n.onAudio)||(null==m?void 0:m.onAudio),onDebug:(null==n?void 0:n.onDebug)||(null==m?void 0:m.onDebug),onUnhandledClientToolCall:(null==n?void 0:n.onUnhandledClientToolCall)||(null==m?void 0:m.onUnhandledClientToolCall),onVadScore:(null==n?void 0:n.onVadScore)||(null==m?void 0:m.onVadScore),onInterruption:(null==n?void 0:n.onInterruption)||(null==m?void 0:m.onInterruption),onAgentToolResponse:(null==n?void 0:n.onAgentToolResponse)||(null==m?void 0:m.onAgentToolResponse),onConversationMetadata:(null==n?void 0:n.onConversationMetadata)||(null==m?void 0:m.onConversationMetadata),onMCPToolCall:(null==n?void 0:n.onMCPToolCall)||(null==m?void 0:m.onMCPToolCall),onMCPConnectionStatus:(null==n?void 0:n.onMCPConnectionStatus)||(null==m?void 0:m.onMCPConnectionStatus),onAsrInitiationMetadata:(null==n?void 0:n.onAsrInitiationMetadata)||(null==m?void 0:m.onAsrInitiationMetadata),onAgentChatResponsePart:(null==n?void 0:n.onAgentChatResponsePart)||(null==m?void 0:m.onAgentChatResponsePart),onModeChange:function(e){var r,o=e.mode;y(o),null==(r=(null==n?void 0:n.onModeChange)||(null==m?void 0:m.onModeChange))||r({mode:o})},onStatusChange:function(e){var r,o=e.status;C(o),null==(r=(null==n?void 0:n.onStatusChange)||(null==m?void 0:m.onStatusChange))||r({status:o})},onCanSendFeedbackChange:function(e){var r,o=e.canSendFeedback;M(o),null==(r=(null==n?void 0:n.onCanSendFeedbackChange)||(null==m?void 0:m.onCanSendFeedbackChange))||r({canSendFeedback:o})}})),Promise.resolve(h.current).then(function(n){return f.current=n,void 0!==w.current&&f.current.setMicMuted(w.current),void 0!==P.current&&f.current.setVolume({volume:P.current}),f.current.getId()}))}catch(n){return r(!0,n)}var t,i,a,g,p,S,T,b,D,I,E,A,R;return o&&o.then?o.then(r.bind(null,!1),r.bind(null,!0)):r(!1,o)}(0,function(n,e){if(h.current=null,n)throw e;return e})};if(null!=(e=f.current)&&e.isOpen())return Promise.resolve(f.current.getId());var t=function(){if(h.current)return Promise.resolve(h.current).then(function(n){var e=n.getId();return r=1,e})}();return Promise.resolve(t&&t.then?t.then(o):o(t))}catch(n){return Promise.reject(n)}},endSession:function(){try{var n=f.current;return f.current=null,Promise.resolve(null==n?void 0:n.endSession()).then(function(){})}catch(n){return Promise.reject(n)}},setVolume:function(n){var e;null==(e=f.current)||e.setVolume({volume:n.volume})},getInputByteFrequencyData:function(){var n;return null==(n=f.current)?void 0:n.getInputByteFrequencyData()},getOutputByteFrequencyData:function(){var n;return null==(n=f.current)?void 0:n.getOutputByteFrequencyData()},getInputVolume:function(){var n,e;return null!=(n=null==(e=f.current)?void 0:e.getInputVolume())?n:0},getOutputVolume:function(){var n,e;return null!=(n=null==(e=f.current)?void 0:e.getOutputVolume())?n:0},sendFeedback:function(n){var e;null==(e=f.current)||e.sendFeedback(n)},getId:function(){var n;return null==(n=f.current)?void 0:n.getId()},sendContextualUpdate:function(n){var e;null==(e=f.current)||e.sendContextualUpdate(n)},sendUserMessage:function(n){var e;null==(e=f.current)||e.sendUserMessage(n)},sendUserActivity:function(){var n;null==(n=f.current)||n.sendUserActivity()},sendMCPToolApprovalResult:function(n,e){var r;null==(r=f.current)||r.sendMCPToolApprovalResult(n,e)},changeInputDevice:function(n){try{var e,r=function(n){if(e)return n;throw new Error("Device switching is only available for voice conversations")},o=function(){if(f.current&&"changeInputDevice"in f.current)return Promise.resolve(f.current.changeInputDevice(n)).then(function(n){return e=1,n})}();return Promise.resolve(o&&o.then?o.then(r):r(o))}catch(n){return Promise.reject(n)}},changeOutputDevice:function(n){try{var e,r=function(n){if(e)return n;throw new Error("Device switching is only available for voice conversations")},o=function(){if(f.current&&"changeOutputDevice"in f.current)return Promise.resolve(f.current.changeOutputDevice(n)).then(function(n){return e=1,n})}();return Promise.resolve(o&&o.then?o.then(r):r(o))}catch(n){return Promise.reject(n)}},status:p,canSendFeedback:T,micMuted:t,isSpeaking:"speaking"===D}}export{v as getLivekitUrlForLocation,d as getOriginForLocation,s as parseLocation,m as useConversation,c as useScribe};
//# sourceMappingURL=lib.module.js.map
